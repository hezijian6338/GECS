<!DOCTYPE html>
<!--
Copyright 2012 Mozilla Foundation

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

Adobe CMap resources are covered by their own copyright but the same license:

    Copyright 1990-2015 Adobe Systems Incorporated.

See https://github.com/adobe-type-tools/cmap-resources
-->
<html dir="ltr" mozdisallowselectionprint moznomarginboxes>
<head lang="zh">
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html;"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes" >
<!--<%&#45;&#45;<title>PDF.js viewer</title>&#45;&#45;%>-->
    <title>电子签章</title>
    <link href="../css/style.css?id=2" rel="stylesheet" />
    <script src="../../js/jquery.js?id=2" type="text/javascript"></script>
    <script src="../js/common.js?id=2" type="text/javascript"></script>
    <link rel="stylesheet" href="viewer.css?id=2">
    <!-- This snippet is used in production (included from viewer.html) -->
    <link rel="resource" type="application/l10n" href="locale/locale.properties">
    <script>
        //从父窗口传过来的文件类型
        var filetype;
        filetype = window.parent.fileType;

        //接收传过来的file参数
        var checkPath;
        if(decodeURI(window.location.search).toString().length > 1){
            var url = decodeURI(window.location.search);
            checkPath = url.substring(url.lastIndexOf('=')+1, url.length);
            checkPath = checkPath.substring(0,checkPath.lastIndexOf('?'))
        }
        var DEFAULT_URL = checkPath;
//        var DEFAULT_URL = '\\pic\\certificate\\Application\\广东珠海香洲3请选择公司类型\\guangdong.pdf';
        var pdfWorkerURL = '../build/pdf.worker.js';
    </script>
    <script src="l10n.js?id=2"></script>
    <script src="../build/pdf.js?id=2"></script>
    <script src="viewer.js?id=3"></script>
    <style>
        /*.toolbar {
            top: 40px;
        }*/
        #viewerContainer {
            margin-top: 72px;
        }
        .pdfViewer .page{
            margin: 1px auto 10px auto;
        }
    </style>
    <style type="text/css">
        .btn-upload{
            width: 40%;
            padding: 4px 8px;
            font-size: 20px;
            background-color: #6b6b6b;
            color: #fff;
            border-radius: 3px;
            font-weight: bold;
            border: none;
            cursor: pointer;
        }
        .black_overlay{
            display: none;
            position: absolute;
            top: 0%;
            left: 0%;
            width: 100%;
            height: 100%;
            background-color: black;
            z-index:1001;
            -moz-opacity: 0.8;
            opacity:.80;
            filter: alpha(opacity=80);
        }
        .white_content {
            display: none;
            position: absolute;
            top: 20%;
            left: 30%;
            text-align:center;
            width: 40%;
            height: 50%;
            box-shadow: 0px 0px 50px 20px #009687;
            background-color: white;
            z-index:1002;
            overflow: hidden;
        }
        .white_content2 {
            display: none;
            position: absolute;
            top: 20%;
            left: 35%;
            text-align:center;
            width: 30%;
            height: 40%;
            box-shadow: 0px 0px 50px 20px #009687;
            background-color: white;
            z-index:1002;
            overflow: auto;
        }
    </style>
    <script type="text/javascript">
        function detectZoom (){
            var ratio = 0,
                screen = window.screen,
                ua = navigator.userAgent.toLowerCase();

            if (window.devicePixelRatio !== undefined) {
                ratio = window.devicePixelRatio;
            }
            else if (~ua.indexOf('msie')) {
                if (screen.deviceXDPI && screen.logicalXDPI) {
                    ratio = screen.deviceXDPI / screen.logicalXDPI;
                }
            }
            else if (window.outerWidth !== undefined && window.innerWidth !== undefined) {
                ratio = window.outerWidth / window.innerWidth;
            }

            if (ratio){
                ratio = Math.round(ratio * 100);
            }

            return ratio;
        };
        //window.onresize 事件可用于检测页面是否触发了放大或缩小。
        $(function(){
            //alert(detectZoom())
        });
        if(!/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
            $(window).on('resize', function () {
                isScale();
            });
            //判断PC端浏览器缩放比例不是100%时的情况
            function isScale() {
                var rate = detectZoom();
                if (rate != 100) {
                    //如何让页面的缩放比例自动为100,'transform':'scale(1,1)'没有用，又无法自动条用键盘事件，目前只能提示让用户如果想使用100%的比例手动去触发按ctrl+0
                    alert('当前页面不是100%显示，请按键盘ctrl+0恢复100%显示标准，以防页面显示错乱！');
                }
            }
        }

        //签名密钥
        var seceret;
            //轮询判断是否已验证成功
            $(document).ready(function () {

                $.extend({
                    getorderstate: function () {
                        var pdfId = "ABC";//示例
                        try {
                            $.ajax({
                                async: false,
                                cache: false,
                                type: 'GET',
                                url: "http://localhost:8086/f/verify/certificate/isPass",
                                data: {
                                    pdfId: pdfId
                                },
                                // dataType: 'json',
                                success: function (result) {
                                    if (result.code == 200) {
                                        seceret = result.signseceret
                                        change('MyDiv');
                                    }
                                    else {
                                        setTimeout("$.getorderstate()", 2000);
                                    }
                                },
                                error: function () { }
                            });
                        }
                        catch (e) {

                        }
                    }

                });

                //第一步：开始轮询
                setTimeout("$.getorderstate()", 2000);//2秒一次

            });

        //弹出隐藏层
        function ShowDiv(show_div,bg_div){
            document.getElementById(show_div).style.display='block';
            document.getElementById(bg_div).style.display='block' ;
            var bgdiv = document.getElementById(bg_div);
            bgdiv.style.width = document.body.scrollWidth;
// bgdiv.style.height = $(document).height();
            $("#"+bg_div).height($(document).height());
        };
        //关闭弹出层
        function CloseDiv(show_div,bg_div)
        {
            document.getElementById(show_div).style.display='none';
            document.getElementById(bg_div).style.display='none';
        };
        //验证通过
        function change(show_div)
        {
            document.getElementById(show_div).style.display='none';
            document.getElementById('MyDiv2').style.display='block';
        };
        //调出签名
        function getSign(show_div,bg_div)
        {
            document.getElementById(show_div).style.display='none';
            document.getElementById(bg_div).style.display='none';
            document.getElementById('signature').style.display='none';
            document.getElementById('sure').style.display='block';
            document.getElementById('signImage').style.visibility='visible';
        };
    </script>
</head>

<body tabindex="1" class="loadingInProgress">

<!--<div class="modal" id="uploadFileModal">
    <div class="upload">
        <h2 class="clearfix">选择文件<img src="${ctxStatic}/img/close.png" class="close" onclick="closeModal()"></h2>
        <hr>
        <form id="form" enctype="multipart/form-data" method="post">
            <div class="clearfix" style="padding:10px 10px">
                <div class="label">文件名：</div>
                <input type="text" class="input" name="fileName" id="fileName">
            </div>
            <div class="clearfix" style="padding:5px 10px;display: none;display: none">
                <div class="label">备注：</div>
                <input type="text" class="input" name="remarks" id="remarks">
            </div>
            <div style="padding:8px 10px;text-align: left">
                <button id="btn-choose" class="btn-choose" type="button">选择文件</button>
                <span class="file-name"></span>
                <input type="file" id="uploadFile" name="file" style="display: none" onchange="filepath(this)">
            </div>
            <div style="padding-top: 20px;padding-bottom: 20px;">
                <button id="upload" class="btn-upload" type="button">确认上传</button>
            </div>
        </form>
    </div>
</div>
<div class="modal" id="checkSealModal">
    <div class="upload">
        <h2 class="clearfix">验章<img src="${ctxStatic}/img/close.png" class="close" onclick="closeCheckSealModal()"></h2>
        <hr>
        <form id="checkSealForm" enctype="multipart/form-data" method="post">
            <div id="up">
                <div style="padding:8px 10px;text-align: left">
                    <button id="btn-check" class="btn-choose" type="button">选择文件</button>
                    <span class="file-name"></span>
                    <input type="file" id="checkSealFile" name="file" style="display: none" onchange="filepath(this)">
                </div>
                <div style="padding-top: 20px;padding-bottom: 20px;">
                    <button id="btn-checkSeal" class="btn-upload" type="button">确认上传</button>
                </div>
            </div>
            <div id="checkseal">

            </div>
        </form>
    </div>
</div>-->

<!--<header style="position: fixed">-->
    <!--<h2 style="color: white">文档签章</h2>-->
    <!--<span class="menu-button"></span>-->
    <!--<div class="menu">-->
        <!--<ul>-->
            <!--<li><a href="###"></a>占位置</li>-->
            <!--<li style="margin-top: 5px"><a href="${ctx}/a/document/info/list">文件列表</a></li>-->
            <!--<li><a href="##" onclick="restar()">重置印模位置</a></li>-->
            <!--<li><a href="##" id="signature">签章</a></li>-->
            <!--&lt;!&ndash;<%&#45;&#45;<li><a href="###" onclick="uploadModal()">上传文件</a></li>&#45;&#45;%>&ndash;&gt;-->
            <!--&lt;!&ndash;<%&#45;&#45;<li><a href="###" onclick="checkSealModal()">验章</a></li>&#45;&#45;%>&ndash;&gt;-->
            <!--<li><a href="${ctx}/a/logout">退出</a></li>-->
        <!--</ul>-->
    <!--</div>-->
<!--</header>-->
<!--<%&#45;&#45;<div style="display:block;text-align: center;position: fixed;bottom: 0;left: calc((100% - 100px)/2);width: 100px;z-index: 1001">&#45;&#45;%>-->
    <!--<%&#45;&#45;<button id="signature" class="btn-upload" style="width: 100px;z-index: 1001">签章</button>&#45;&#45;%>-->
<!--<%&#45;&#45;</div>&#45;&#45;%>-->
<!--<%&#45;&#45;<div style="width:140px;height:140px;z-index:999;border:2px solid #ccc; position:fixed; left: 500px;top:100px;background: url('/img${seal.eleModel}');background-size: cover;cursor: pointer"&#45;&#45;%>-->
     <!--<%&#45;&#45;id="div">&#45;&#45;%>-->
<!--<%&#45;&#45;</div>&#45;&#45;%>-->
<!--<%&#45;&#45;原生代码&#45;&#45;%>-->
<div id="outerContainer">

    <div id="sidebarContainer">
        <div id="toolbarSidebar">
            <div class="splitToolbarButton toggled">
                <button id="viewThumbnail" class="toolbarButton toggled" title="Show Thumbnails" tabindex="2"
                        data-l10n-id="thumbs">
                    <span data-l10n-id="thumbs_label">Thumbnails</span>
                </button>
                <button id="viewOutline" class="toolbarButton"
                        title="Show Document Outline (double-click to expand/collapse all items)" tabindex="3"
                        data-l10n-id="document_outline">
                    <span data-l10n-id="document_outline_label">Document Outline</span>
                </button>
                <button id="viewAttachments" class="toolbarButton" title="Show Attachments" tabindex="4"
                        data-l10n-id="attachments">
                    <span data-l10n-id="attachments_label">Attachments</span>
                </button>
            </div>
        </div>
        <div id="sidebarContent">
            <div id="thumbnailView">
            </div>
            <div id="outlineView" class="hidden">
            </div>
            <div id="attachmentsView" class="hidden">
            </div>
        </div>
    </div>  <!-- sidebarContainer -->

    <div id="mainContainer" >
        <div class="findbar hidden doorHanger" id="findbar">
            <div id="findbarInputContainer">
                <input id="findInput" class="toolbarField" title="Find" placeholder="Find in document…" tabindex="91"
                       data-l10n-id="find_input">
                <div class="splitToolbarButton">
                    <button id="findPrevious" class="toolbarButton findPrevious"
                            title="Find the previous occurrence of the phrase" tabindex="92"
                            data-l10n-id="find_previous">
                        <span data-l10n-id="find_previous_label">Previous</span>
                    </button>
                    <div class="splitToolbarButtonSeparator"></div>
                    <button id="findNext" class="toolbarButton findNext" title="Find the next occurrence of the phrase"
                            tabindex="93" data-l10n-id="find_next">
                        <span data-l10n-id="find_next_label">Next</span>
                    </button>
                </div>
            </div>

            <div id="findbarOptionsContainer">
                <input type="checkbox" id="findHighlightAll" class="toolbarField" tabindex="94">
                <label for="findHighlightAll" class="toolbarLabel" data-l10n-id="find_highlight">Highlight all</label>
                <input type="checkbox" id="findMatchCase" class="toolbarField" tabindex="95">
                <label for="findMatchCase" class="toolbarLabel" data-l10n-id="find_match_case_label">Match case</label>
                <span id="findResultsCount" class="toolbarLabel hidden"></span>
            </div>

            <div id="findbarMessageContainer">
                <span id="findMsg" class="toolbarLabel"></span>
            </div>
        </div>  <!-- findbar -->

        <div id="secondaryToolbar" class="secondaryToolbar hidden doorHangerRight">
            <div id="secondaryToolbarButtonContainer">
                <button id="secondaryPresentationMode" class="secondaryToolbarButton presentationMode visibleLargeView"
                        title="Switch to Presentation Mode" tabindex="51" data-l10n-id="presentation_mode">
                    <span data-l10n-id="presentation_mode_label">Presentation Mode</span>
                </button>

                <button id="secondaryOpenFile" class="secondaryToolbarButton openFile visibleLargeView"
                        title="Open File" tabindex="52" data-l10n-id="open_file">
                    <span data-l10n-id="open_file_label">Open</span>
                </button>

                <button id="secondaryPrint" class="secondaryToolbarButton print visibleMediumView" title="Print"
                        tabindex="53" data-l10n-id="print">
                    <span data-l10n-id="print_label">Print</span>
                </button>

                <button id="secondaryDownload" class="secondaryToolbarButton download visibleMediumView"
                        title="Download" tabindex="54" data-l10n-id="download">
                    <span data-l10n-id="download_label">Download</span>
                </button>

                <a href="#" id="secondaryViewBookmark" class="secondaryToolbarButton bookmark visibleSmallView"
                   title="Current view (copy or open in new window)" tabindex="55" data-l10n-id="bookmark">
                    <span data-l10n-id="bookmark_label">Current View</span>
                </a>

                <div class="horizontalToolbarSeparator visibleLargeView"></div>

                <button id="firstPage" class="secondaryToolbarButton firstPage" title="Go to First Page" tabindex="56"
                        data-l10n-id="first_page">
                    <span data-l10n-id="first_page_label">Go to First Page</span>
                </button>
                <button id="lastPage" class="secondaryToolbarButton lastPage" title="Go to Last Page" tabindex="57"
                        data-l10n-id="last_page">
                    <span data-l10n-id="last_page_label">Go to Last Page</span>
                </button>

                <div class="horizontalToolbarSeparator"></div>

                <button id="pageRotateCw" class="secondaryToolbarButton rotateCw" title="Rotate Clockwise" tabindex="58"
                        data-l10n-id="page_rotate_cw">
                    <span data-l10n-id="page_rotate_cw_label">Rotate Clockwise</span>
                </button>
                <button id="pageRotateCcw" class="secondaryToolbarButton rotateCcw" title="Rotate Counterclockwise"
                        tabindex="59" data-l10n-id="page_rotate_ccw">
                    <span data-l10n-id="page_rotate_ccw_label">Rotate Counterclockwise</span>
                </button>

                <div class="horizontalToolbarSeparator"></div>

                <button id="toggleHandTool" class="secondaryToolbarButton handTool" title="Enable hand tool"
                        tabindex="60" data-l10n-id="hand_tool_enable">
                    <span data-l10n-id="hand_tool_enable_label">Enable hand tool</span>
                </button>

                <div class="horizontalToolbarSeparator"></div>

                <button id="documentProperties" class="secondaryToolbarButton documentProperties"
                        title="Document Properties…" tabindex="61" data-l10n-id="document_properties">
                    <span data-l10n-id="document_properties_label">Document Properties…</span>
                </button>
            </div>
        </div>  <!-- secondaryToolbar -->

        <div class="toolbar">
            <div id="toolbarContainer">
                <div id="toolbarViewer" style="background-color: rgba(105,105,105,0.8);">
                    <div id="toolbarViewerLeft">
                        <button id="sidebarToggle" class="toolbarButton" title="Toggle Sidebar" tabindex="11"
                                data-l10n-id="toggle_sidebar">
                            <span data-l10n-id="toggle_sidebar_label">Toggle Sidebar</span>
                        </button>
                        <div class="toolbarButtonSpacer"></div>
                        <button id="viewFind" style="display: none" class="toolbarButton" title="Find in Document"
                                tabindex="12" data-l10n-id="findbar">
                            <span data-l10n-id="findbar_label">Find</span>
                        </button>
                        <div class="splitToolbarButton hiddenSmallView">
                            <button class="toolbarButton pageUp" title="Previous Page" id="previous" tabindex="13"
                                    data-l10n-id="previous">
                                <span data-l10n-id="previous_label">Previous</span>
                            </button>
                            <div class="splitToolbarButtonSeparator"></div>
                            <button class="toolbarButton pageDown" title="Next Page" id="next" tabindex="14"
                                    data-l10n-id="next">
                                <span data-l10n-id="next_label">Next</span>
                            </button>
                        </div>
                        <input type="number" id="pageNumber" class="toolbarField pageNumber" title="Page" value="1"
                               size="4" min="1" tabindex="15" data-l10n-id="page">
                        <span id="numPages" class="toolbarLabel"></span>
                    </div>
                    <div id="toolbarViewerRight">
                        <button id="presentationMode" class="toolbarButton presentationMode hiddenLargeView"
                                title="Switch to Presentation Mode" tabindex="31" data-l10n-id="presentation_mode">
                            <span data-l10n-id="presentation_mode_label">Presentation Mode</span>
                        </button>

                        <button id="openFile" style="display: none" class="toolbarButton openFile hiddenLargeView"
                                title="Open File" tabindex="32" data-l10n-id="open_file">
                            <span data-l10n-id="open_file_label">Open</span>
                        </button>

                        <button id="print" class="toolbarButton print hiddenMediumView" title="Print" tabindex="33"
                                data-l10n-id="print">
                            <span data-l10n-id="print_label">Print</span>
                        </button>

                        <button id="download" class="toolbarButton download hiddenMediumView" title="Download"
                                tabindex="34" data-l10n-id="download">
                            <span data-l10n-id="download_label">Download</span>
                        </button>
                        <a href="#" id="viewBookmark" style="display: none"
                           class="toolbarButton bookmark hiddenSmallView"
                           title="Current view (copy or open in new window)" tabindex="35" data-l10n-id="bookmark">
                            <span data-l10n-id="bookmark_label">Current View</span>
                        </a>

                        <div class="verticalToolbarSeparator hiddenSmallView"></div>

                        <button id="secondaryToolbarToggle" class="toolbarButton" title="Tools" tabindex="36"
                                data-l10n-id="tools">
                            <span data-l10n-id="tools_label">Tools</span>
                        </button>
                    </div>
                    <div id="toolbarViewerMiddle" style="display: none">
                        <div class="splitToolbarButton">
                            <button id="zoomOut" class="toolbarButton zoomOut" title="Zoom Out" tabindex="21"
                                    data-l10n-id="zoom_out">
                                <span data-l10n-id="zoom_out_label">Zoom Out</span>
                            </button>
                            <div class="splitToolbarButtonSeparator"></div>
                            <button id="zoomIn" class="toolbarButton zoomIn" title="Zoom In" tabindex="22"
                                    data-l10n-id="zoom_in">
                                <span data-l10n-id="zoom_in_label">Zoom In</span>
                            </button>
                        </div>
                        <span id="scaleSelectContainer" class="dropdownToolbarButton">
                  <select id="scaleSelect" title="Zoom" tabindex="23" data-l10n-id="zoom">
                    <option id="pageAutoOption" title="" value="auto" selected="selected"
                            data-l10n-id="page_scale_auto">Automatic Zoom</option>
                    <option id="pageActualOption" title="" value="page-actual" data-l10n-id="page_scale_actual">Actual Size</option>
                    <option id="pageFitOption" title="" value="page-fit" data-l10n-id="page_scale_fit">Fit Page</option>
                    <option id="pageWidthOption" title="" value="page-width"
                            data-l10n-id="page_scale_width">Full Width</option>
                    <option id="customScaleOption" title="" value="custom" disabled="disabled" hidden="true"></option>
                    <option title="" value="0.5" data-l10n-id="page_scale_percent"
                            data-l10n-args='{ "scale": 50 }'>50%</option>
                    <option title="" value="0.75" data-l10n-id="page_scale_percent"
                            data-l10n-args='{ "scale": 75 }'>75%</option>
                    <option title="" value="1" data-l10n-id="page_scale_percent"
                            data-l10n-args='{ "scale": 100 }'>100%</option>
                    <option title="" value="1.25" data-l10n-id="page_scale_percent" data-l10n-args='{ "scale": 125 }'>125%</option>
                    <option title="" value="1.5" data-l10n-id="page_scale_percent" data-l10n-args='{ "scale": 150 }'>150%</option>
                    <option title="" value="2" data-l10n-id="page_scale_percent"
                            data-l10n-args='{ "scale": 200 }'>200%</option>
                    <option title="" value="3" data-l10n-id="page_scale_percent"
                            data-l10n-args='{ "scale": 300 }'>300%</option>
                    <option title="" value="4" data-l10n-id="page_scale_percent"
                            data-l10n-args='{ "scale": 400 }'>400%</option>
                  </select>
                </span>
                    </div>
                </div>
                <div id="loadingBar">
                    <div class="progress">
                        <div class="glimmer">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <menu type="context" id="viewerContextMenu" style="width: 1000px;">
            <menuitem id="contextFirstPage" label="First Page"
                      data-l10n-id="first_page"></menuitem>
            <menuitem id="contextLastPage" label="Last Page"
                      data-l10n-id="last_page"></menuitem>
            <menuitem id="contextPageRotateCw" label="Rotate Clockwise"
                      data-l10n-id="page_rotate_cw"></menuitem>
            <menuitem id="contextPageRotateCcw" label="Rotate Counter-Clockwise"
                      data-l10n-id="page_rotate_ccw"></menuitem>
        </menu>
        <!--<%&#45;&#45;修改架构，增加代码&#45;&#45;%>-->
        <div id="viewerContainer" tabindex="0" style="position: relative">
            <!--<%&#45;&#45;增加印模图片，用于拖动和获得坐标&#45;&#45;%>-->
            <div style="width:120px;height:60px;z-index:999;border:2px solid #ccc;
                    position:absolute; left: 500px;top:50px;
                    background: url('http://sign.ieseals.cn:9980/Interface/Interface/GetSignImg?token=74f0cc8a-21b6-4c61-8dbf-%2000f6e26a1626&signseceret=2ba5b15b-0c35-4375-8d48-69938f3e8891');
                    background-size: cover;cursor: pointer;visibility: hidden;"
                 id="signImage">
            </div>

            <div id="viewer" class="pdfViewer" style="user-select: none;"></div>
        </div>

        <div id="errorWrapper" hidden='true'>
            <div id="errorMessageLeft">
                <span id="errorMessage"></span>
                <button id="errorShowMore" data-l10n-id="error_more_info">
                    More Information
                </button>
                <button id="errorShowLess" data-l10n-id="error_less_info" hidden='true'>
                    Less Information
                </button>
            </div>
            <div id="errorMessageRight">
                <button id="errorClose" data-l10n-id="error_close">
                    Close
                </button>
            </div>
            <div class="clearBoth"></div>
            <textarea id="errorMoreInfo" hidden='true' readonly="readonly"></textarea>
        </div>
    </div> <!-- mainContainer -->

    <div id="overlayContainer" class="hidden">
        <div id="passwordOverlay" class="container hidden">
            <div class="dialog">
                <div class="row">
                    <p id="passwordText" data-l10n-id="password_label">Enter the password to open this PDF file:</p>
                </div>
                <div class="row">
                    <!-- The type="password" attribute is set via script, to prevent warnings in Firefox for all http:// documents. -->
                    <input id="password" class="toolbarField">
                </div>
                <div class="buttonRow">
                    <button id="passwordCancel" class="overlayButton"><span data-l10n-id="password_cancel">Cancel</span>
                    </button>
                    <button id="passwordSubmit" class="overlayButton"><span data-l10n-id="password_ok">OK</span>
                    </button>
                </div>
            </div>
        </div>
        <div id="documentPropertiesOverlay" class="container hidden">
            <div class="dialog">
                <div class="row">
                    <span data-l10n-id="document_properties_file_name">File name:</span>
                    <p id="fileNameField">-</p>
                </div>
                <div class="row">
                    <span data-l10n-id="document_properties_file_size">File size:</span>
                    <p id="fileSizeField">-</p>
                </div>
                <div class="separator"></div>
                <div class="row">
                    <span data-l10n-id="document_properties_title">Title:</span>
                    <p id="titleField">-</p>
                </div>
                <div class="row">
                    <span data-l10n-id="document_properties_author">Author:</span>
                    <p id="authorField">-</p>
                </div>
                <div class="row">
                    <span data-l10n-id="document_properties_subject">Subject:</span>
                    <p id="subjectField">-</p>
                </div>
                <div class="row">
                    <span data-l10n-id="document_properties_keywords">Keywords:</span>
                    <p id="keywordsField">-</p>
                </div>
                <div class="row">
                    <span data-l10n-id="document_properties_creation_date">Creation Date:</span>
                    <p id="creationDateField">-</p>
                </div>
                <div class="row">
                    <span data-l10n-id="document_properties_modification_date">Modification Date:</span>
                    <p id="modificationDateField">-</p>
                </div>
                <div class="row">
                    <span data-l10n-id="document_properties_creator">Creator:</span>
                    <p id="creatorField">-</p>
                </div>
                <div class="separator"></div>
                <div class="row">
                    <span data-l10n-id="document_properties_producer">PDF Producer:</span>
                    <p id="producerField">-</p>
                </div>
                <div class="row">
                    <span data-l10n-id="document_properties_version">PDF Version:</span>
                    <p id="versionField">-</p>
                </div>
                <div class="row">
                    <span data-l10n-id="document_properties_page_count">Page Count:</span>
                    <p id="pageCountField">-</p>
                </div>
                <div class="buttonRow">
                    <button id="documentPropertiesClose" class="overlayButton"><span
                            data-l10n-id="document_properties_close">Close</span></button>
                </div>
            </div>
        </div>
        <div id="printServiceOverlay" class="container hidden">
            <div class="dialog">
                <div class="row">
                    <span data-l10n-id="print_progress_message">Preparing document for printing…</span>
                </div>
                <div class="row">
                    <progress value="0" max="100"></progress>
                    <span data-l10n-id="print_progress_percent" data-l10n-args='{ "progress": 0 }'
                          class="relative-progress">0%</span>
                </div>
                <div class="buttonRow">
                    <button id="printCancel" class="overlayButton"><span
                            data-l10n-id="print_progress_close">Cancel</span></button>
                </div>
            </div>
        </div>
    </div>  <!-- overlayContainer -->
    <div style="text-align: center;position: fixed;bottom: 0;left: calc((100% - 100px)/2);z-index: 999">
        <button id="signature" class="btn-upload" style="width: 100px;z-index: 999;
        background-color: #FF4500" onclick="ShowDiv('MyDiv','fade')">签章</button>
        <button id="sure" class="btn-upload" style="width: 100px;z-index: 999;display:none;
        background-color: #FF4500" onclick="sign()">确认</button>

        <button id="wait-btn" class="btn-upload" type="button"
                style="width: 150px;z-index: 999;display:none;background-color: #FF4500">
            <img width="18px" height="" src="images/loading-small.png">
            &nbsp;请稍后...
        </button>
    </div>

    <!--弹出层时背景层DIV-->
    <div id="fade" class="black_overlay"></div>

    <div id="MyDiv" class="white_content">
        <div style="text-align: right; cursor: default; height: 10px;">
            <img src="images/close.png" onclick="CloseDiv('MyDiv','fade')" style="width: 10%;height: auto;"/>
        </div>
        <img src="http://sign.ieseals.cn:9988/qrcode?code=20AB0011ABC&showcode=请打开【电子签名App】进行身份验证" style="width: 50%;height: auto;">
    </div>

    <!--验证通过时背景层DIV-->
    <div id="MyDiv2" class="white_content2">
        <img src="images/pass3.png" style="width: 30%;height: auto;margin-top: 30px;">
        <h2 style="color: #4cae4c;margin-top: 20px;">已通过身份验证，拖动签名进行签署.</h2>
        <button id="ok" class="btn-upload" style="width: 250px;margin-top: 10px;
        background-color: #FF4500" onclick="getSign('MyDiv2','fade')">确认</button>
    </div>

</div> <!-- outerContainer -->
<div id="printContainer"></div>
<!--<%&#45;&#45;数据提交表单&#45;&#45;%>-->
<!--<form id="form-sign" style="display: none">
    <input name="point.x" id="x">
    <input name="point.y" id="y">
    <input name="point.width" id="width">
    <input name="point.high" id="high">
    <input name="point.pageSize" id="pageSize">
    <input name="point.pxWidth" id="pageWidth">
    <input name="point.pxHigh" id="pageHeight">
    <input name="document" id="document">
    <input name="seal" id="seal">
</form>-->

<!--签名所需参数-->
<form id="form-signParam" style="display: none">
    <input name="signseceret" id="signseceret">
    <input name="document" id="document">
    <input name="pageSize" id="pageSize">
    <input name="sign_domain" id="sign_domain">
    <input name="llx" id="llx">
    <input name="lly" id="lly">
    <input name="urx" id="urx">
    <input name="ury" id="ury">
</form>
<!--<script>
    //alert(document.getElementById("viewer"));
    function getScrollTop() {
        var scrollPos = document.documentElement.scrollTop || document.body.scrollTop;
        return scrollPos;
    }
    window.onscroll = parent.div.onmouseup;
</script>-->
<!--<%&#45;&#45;自己写的js脚本&#45;&#45;%>-->
<script>
    window.setTimeout(function(){document.title = "签章"},1000);
//    印模位置重置
    function restar(){
        div.style.top = yScroll + 100 + 'px';
//        <%--获取y坐标和页码--%>
        if(pageCount == 0){
            pageCount = parseInt((parseInt(div.style.top) - 10) / pageHeight);
            py = (parseInt(div.style.top) - 10) % pageHeight;
        }else{
            pageCount = parseInt((parseInt(div.style.top) - 10 - (pageCount-1)*10) / pageHeight);
            py = (parseInt(div.style.top) - 10 - (pageCount*10)) % pageHeight;
        }
    }

    //确认签名
    function sign() {
        var leftX = px
        var leftY = pageHeight - py - ph
        var rightX = px + pw
        var rightY = pageHeight - py
        var pageSizeCount = pageCount + 1
        console.log("左下角X：" + leftX + ";左下角Y：" + leftY + ";右上角X：" + rightX + ";右上角Y：" + rightY + ";页数：" + pageSizeCount)

        var msg = "确认签署？";
        if (confirm(msg) == true) {

            if (py >= pageHeight - 10 || py >= pageHeight - ph) {
                alert("请在文档中签署！");
                return false;
            }

            var token = "12bb5c82-b65b-4aab-b8a0-87d19587eabe";
            var membercode = "ad1a2fd7-53c5-463b-a35c-8bdd8861100b";

            $("#sure").hide();
            $("#wait-btn").show();
            $.ajax({
//            url: "http://sign.ieseals.cn:9961/signClientDemo/api/upload?token="+token+"&membercode="+membercode,
                url: "http://localhost:8086/f/verify/certificate/upload?token=" + token + "&membercode=" + membercode + "&checkPath=" + checkPath,
                type: "POST",
                dataType: "json",
                cache: false,
                processData: false,
                contentType: false,
                success: function (result) {
                    if (result.code == 200) {

                        $("#signseceret").val(seceret);
                        $("#document").val(result.message);
                        $("#pageSize").val(pageSizeCount);
                        $("#sign_domain").val("sign1");
                        $("#llx").val(leftX);
                        $("#lly").val(leftY);
                        $("#urx").val(rightX);
                        $("#ury").val(rightY);
                        var formdata = new FormData($("#form-signParam")[0]);
//            console.log(formdata);
                        $.ajax({
//                        url: "http://sign.ieseals.cn:9961/qm/a/signature/qm/pass/sign.do?token="+token,
                            url: "http://localhost:8081/a/signature/qm/pass/sign.do?token=" + token,
//                        url: "http://localhost:8081/qm/a/signature/qm/pass/sign.do?token="+token,
                            type: "POST",
                            data: formdata,
                            dataType: "JSON",
                            cache: false,
                            processData: false,
                            contentType: false,
                            success: function (result) {
                                console.log(result)
                                if (result.code == 200) {
                                    alert(result.message);
                                    window.parent.updatePath(result.url,filetype);

                                }else{
                                    alert(result.message);
                                }
                            },
                            error: function(){
                                alert("签章失败!")
                                $("#sure").show();
                                $("#wait-btn").hide();
                            }
                        });
//                    location.reload();
                    } else {
                        alert(result.message);
                    }
                },
                error: function () {
                    alert("文件操作有误！");
                    $("#sure").show();
                    $("#wait-btn").hide();
                }
            });
        }else {
            return false;
        }
    }



    //拖拽功能
    var div = document.getElementById("signImage"); //签章div
    var px,py;
    var pw = parseInt(div.style.width); //签章宽度
    var ph = parseInt(div.style.height); //签章高度
    var add = 0;lastScroll = 0;//滚动相较上次增加的值，上次滚动的值
    var wh = document.body.clientHeight;//获取页面高度
    var yScroll = 0; //当前相对pdf首页顶部高度
    var iframe = document.getElementById('myFrame'); //pdfFrame
    var page, pageWidth, pageHeight, pageLeft, pageCount;//pdf的每一页，每一页的宽度，每一页的高度，每一页相对左边的宽度，相对右边的宽度（空白）
    var viewWidth = document.getElementById('viewer').offsetWidth;//页面宽度
    var viewHeight = document.getElementById('viewer').offsetHeight;//页面可视高度
//    页面滚动时的事件
    $(window).scroll(function(){
        //为了保证兼容性，这里取两个值，哪个有值取哪一个
        yScroll = document.documentElement.scrollTop || document.body.scrollTop;
        //scrollTop就是触发滚轮事件时滚轮的高度
        div.style.top = parseInt(div.style.top) + add + "px";
        if (parseInt(div.style.top) < 10) {
            div.style.top = 10 + 'px';
        }
//        <%--初始化值--%>
        page = document.getElementsByClassName('page')[0];
        pageWidth = parseInt(page.style.width);
        pageHeight = parseInt(page.style.height);
        pageLeft = (parseInt(viewWidth) - pageWidth)/2;
        px = parseInt(div.style.left) - pageLeft - 7.5;
        pageCount = parseInt((parseInt(div.style.top) - 10) / pageHeight);
//        <%--如果页码为0，计算y坐标值--%>
        if(pageCount == 0){
            pageCount = parseInt((parseInt(div.style.top) - 10) / pageHeight);
            py = (parseInt(div.style.top) - 10) % pageHeight;
        }else{
//            <%--如果页码不为0，计算y值要加上两页之间宽度--%>
            pageCount = parseInt((parseInt(div.style.top) - 10 - (pageCount-1)*10) / pageHeight);
            py = (parseInt(div.style.top) - 10 - (pageCount*10)) % pageHeight;
        }
//        console.log("签章的坐标x=" + px + ", y=" + py + ", 签章宽度w=" + pw + ", 高度h=" + ph + ", 页码数count=" + pageCount);
//        <%--计算页面滚动量--%>
        add = yScroll - lastScroll;
        lastScroll = yScroll;
    });
    //手机端拖动
//    <%--识别手机端操作系统--%>
    if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)){
//        <%--重设印模位置和大小--%>
        document.getElementById("div").style.top = "84px";
        document.getElementById("div").style.left = "50px";
        document.getElementById("div").style.width = "50px";
        document.getElementById("div").style.height = "50px";
        pw = 50;
        ph = 50;
        var flag = false;
        var cur = {
            x:0,
            y:0
        };
        var nx,ny,dx,dy,x,y ;
//        <%--手指按下时调用--%>
        function down(){
            flag = true;
            var touch ;
            if(event.touches){
                touch = event.touches[0];
            }else {
                touch = event;
            }
            cur.x = touch.clientX;
            cur.y = touch.clientY;
            dx = parseInt(div2.style.left);
            dy = parseInt(div2.style.top);
        }
//        <%--手指移动时调用--%>
        function move(){
            if(flag){
                var touch ;
                if(event.touches){
                    touch = event.touches[0];
                }else {
                    touch = event;
                }
//                <%--初始化数据--%>
                page = document.getElementsByClassName('page')[0]; //每页
                viewWidth = document.getElementById('viewer').offsetWidth;
                viewHeight = document.getElementById('viewer').offsetHeight;
                pageWidth = parseInt(page.style.width);
                pageHeight = parseInt(page.style.height);
                pageLeft = (parseInt(viewWidth) - pageWidth)/2;
                nx = touch.clientX - cur.x;
                ny = touch.clientY - cur.y;
                x = dx+nx;
                y = dy+ny;
//                <%--限制印模不能拖出页面左右代码--%>
//                <%--如果小于最左边，则x值不再减小--%>
                if(x < (pageLeft + 8)){
                    div2.style.left = (pageLeft + 8)+"px";
                }else if(x > (pageLeft + pageWidth - parseInt(document.getElementById("div").style.width) + 8)){
//                    <%--如果大于最左边，则x值不再增加--%>
                    div2.style.left = (pageLeft + pageWidth - parseInt(document.getElementById("div").style.width) + 8) + "px";
                }else{
//                    <%--否则x值随手指移动改变--%>
                    div2.style.left = x+"px";
                }
//                <%--控制印模不能拖出pdf页面上下代码--%>
//                <%--如果小于页面，则不再减小--%>
                if(y < 10){
                    div2.style.top = 10 +"px";
                }else if(y > (viewHeight - parseInt(document.getElementById("div").style.height) + 10)){
//                    <%--如果大于页面，则不再增加--%>
                    div2.style.top = (viewHeight - parseInt(document.getElementById("div").style.height) + 10) +"px";
                }else{
                    div2.style.top = y +"px";
                }
                //阻止页面的滑动默认事件
                $("body").on("touchmove",function(event){
                    event.preventDefault;
                }, false);
            }
        }
        //手指释放时候的函数
        function end(){
            flag = false;
//            <%--初始化值--%>
            viewWidth = document.getElementById('viewer').offsetWidth;
            page = document.getElementsByClassName('page')[0]; //iframe内pdf对象
            pageLeft = (parseInt(viewWidth) - pageWidth)/2;
            px = parseInt(div2.style.left) - pageLeft - 8;
            pageHeight = parseInt(page.style.height);
            pageLeft = parseInt(page.offsetLeft);
            pageCount = parseInt((parseInt(div2.style.top) - 10) / pageHeight);
//            <%--如果页码为0，计算y坐标值--%>
            if(pageCount == 0){
                pageCount = parseInt((parseInt(div.style.top) - 10) / pageHeight);
                py = (parseInt(div.style.top) - 10) % pageHeight;
            }else{
//                <%--如果页码不为0，计算y值要加上两页之间宽度--%>
                pageCount = parseInt((parseInt(div.style.top) - 10 - (pageCount-1)*10) / pageHeight);
                py = (parseInt(div.style.top) - 10 - (pageCount*10)) % pageHeight;
            }
            //        不允许在两页中间的控制
//            <%--y坐标高过页面且在两页中间，则弹回此页顶点--%>
            if(py >= pageHeight-10){
                div.style.top = (parseInt(div.style.top) + pageHeight - py) + 'px';
                py = 0;
            }else if(py >= pageHeight-ph){
//                <%--y坐标超过此页，则弹回此页--%>
                div.style.top = (parseInt(div.style.top) - (ph - (pageHeight - py))) + 'px';
                py = (parseInt(div.style.top) - 10 - (pageCount*10)) % pageHeight;
            }
//            console.log("签章的坐标x=" + px + ", y=" + py + ", 签章宽度w=" + pw + ", 高度h=" + ph + ", 页码数count=" + pageCount);
            //关闭阻止页面的滑动事件
            $("body").off("touchmove");
        }
        var div2 = document.getElementById("div");
        div2.addEventListener("mousedown",function(){
            down();
        },false);
        div2.addEventListener("touchstart",function(){
            down();
        },false);
        div2.addEventListener("mousemove",function(){
            move();
        },false);
        div2.addEventListener("touchmove",function(){
            move();
        },false);
        document.body.addEventListener("mouseup",function(){
            end();
        },false);
        div2.addEventListener("touchend",function(){
            end();
        },false);
    }
    //    手机端结束
    //    PC端
    div.onmousedown = function (e) {
//        <%--鼠标按下时，设置默认值--%>
        px = e.clientX - parseInt(div.style.left);
        py = e.clientY - parseInt(div.style.top);
        div.onmousemove = mousemove;
        div.onmouseleave = div.onmouseup;
    };
//    <%--鼠标释放时--%>
    div.onmouseup = function () {
        div.onmousemove = null;
//        <%--初始化值--%>
        viewWidth = document.getElementById('viewer').offsetWidth;
        page = document.getElementsByClassName('page')[0]; //每页
        pageLeft = (parseInt(viewWidth) - pageWidth)/2;
        px = parseInt(div.style.left) - pageLeft - 7.5;
        pageHeight = parseInt(page.style.height);
        pageCount = parseInt((parseInt(div.style.top) - 10) / pageHeight);
//        <%--如果页码为0，计算y坐标值--%>
        if(pageCount == 0){
            pageCount = parseInt((parseInt(div.style.top) - 10) / pageHeight);
            py = (parseInt(div.style.top) - 10) % pageHeight;
        }else{
//            <%--如果页码不为0，计算y值要加上两页之间宽度--%>
            pageCount = parseInt((parseInt(div.style.top) - 10 - (pageCount-1)*10) / pageHeight);
            py = (parseInt(div.style.top) - 10 - (pageCount*10)) % pageHeight;
        }
//        不允许在两页中间的控制
//        <%--y坐标高过页面且在两页中间，则弹回此页顶点--%>
        if(py >= pageHeight-10){
            div.style.top = (parseInt(div.style.top) + pageHeight - py) + 'px';
            py = 0;
        }else if(py >= pageHeight-ph){
//            <%--y坐标超过此页，则弹回此页--%>
            div.style.top = (parseInt(div.style.top) - (ph - (pageHeight - py))) + 'px';
            py = (parseInt(div.style.top) - 10 - (pageCount*10)) % pageHeight;
        }
//        console.log("签章的坐标x=" + px + ", y=" + py + ", 签章宽度w=" + pw + ", 高度h=" + ph + ", 页码数count=" + pageCount);
    };
//    <%--鼠标移动时--%>
    function mousemove(em) {$("#viewer").off("touchmove");
        if (!em) em = window.event;//if不是firefox等浏览器，那么e为IE浏览器
//        <%--初始化值--%>
        page = document.getElementsByClassName('page')[0]; //每页
        viewWidth = document.getElementById('viewer').offsetWidth;
        viewHeight = document.getElementById('viewer').offsetHeight;
        pageWidth = parseInt(page.style.width);
        pageHeight = parseInt(page.style.height);
        pageLeft = (parseInt(viewWidth) - pageWidth)/2;
//        <%--限制印模不能拖出页面左右代码--%>
//        <%--如果小于最左边，则x值不再减小--%>
        if ((em.clientX - px) < (pageLeft + 8)) {
            div.style.left = (pageLeft + 8) + 'px';
        } else if ((em.clientX - px) > (pageLeft + pageWidth - pw + 10)) {
//            <%--如果大于最左边，则x值不再增加--%>
            div.style.left = (pageLeft + pageWidth - pw + 10) + 'px';
        } else {
//            <%--否则x值随手指移动改变--%>
            div.style.left = (em.clientX - px) + 'px';
        }
//        <%--控制印模不能拖出pdf页面上下代码--%>
//        <%--如果小于页面，则不再减小--%>
        if ((em.clientY - py) < 10) {
            div.style.top = 10 + 'px';
        } else if ((em.clientY - py) > (viewHeight - ph + 10)) {
//            <%--如果大于页面，则不再增加--%>
            div.style.top = (viewHeight - ph + 10) + 'px';
        }else{
            div.style.top = (em.clientY - py) + 'px';
        }
//        <%--限制印模不能拖出浏览器可视区域顶部--%>
        if(parseInt(div.style.top) < parseInt(yScroll)){
            div.style.top = yScroll + 'px';
        }else if(parseInt(div.style.top) > (parseInt(yScroll) + wh -ph)){
            div.style.top = (parseInt(yScroll) + wh -ph) + 'px';
        }
    }
</script>
<script type="text/javascript">


</script>
</body>
</html>

